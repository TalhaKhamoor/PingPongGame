<!DOCTYPE html>
<html>
  <head>
    <title>Ping Pong Game</title>
    <style>
      body,
      html {
        width: 100%;
        height: 100%;
        margin: 0;
        overflow: hidden;
        display: block;
        background-color: black;
      }
    </style>
  </head>
  <body>
    <canvas
      id="canvas"
      width="800"
      height="400"
      style="
        background-color: black;
        border: 12px dashed white;
        padding-left: 0;
        padding-right: 0;
        margin-left: auto;
        margin-right: auto;
        display: block;
        width: 98%;
      "
    ></canvas>
    <script type="text/javascript" src="js/app.js"></script>
    <script type="text/javascript">
      //Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.
      var speedOfPaddle1 = 0;
      var speedOfPaddle2 = 0;
      app.onInit = function () {
        this.canvas = document.getElementById("canvas");
        this.context = this.canvas.getContext("2d");

        this.nodes.push({
          id: "player-one",
          x: 10,
          y: canvas.height / 2 - (canvas.height * 0.2) / 2,
          width: canvas.width * 0.01,
          height: canvas.height * 0.2,
          color: "white",
        });

        this.nodes.push({
          id: "player-two",
          x: canvas.width - (10 + canvas.width * 0.01),
          y: canvas.height / 2 - (canvas.height * 0.2) / 2,
          width: canvas.width * 0.01,
          height: canvas.height * 0.2,
          color: "white",
        });

        this.nodes.push({
          id: "ball",
          x: canvas.width / 2,
          y: canvas.height / 2,
          width: this.getNode("player-one").width,
          height: this.getNode("player-one").width,
          color: "white",
          direction: 0,
        });

        this.nodes.push({
          id: "line",
          x: canvas.width / 2 - 3.5,
          y: 0,
          width: 7,
          height: canvas.height,
          color: "white",
        });

        document.addEventListener("keydown", (e) => {
          if (e.keyCode != 32) {
            if (e.keyCode == 87) {
              speedOfPaddle1 = -2;
            } else if (e.keyCode == 83) {
              speedOfPaddle1 = +2;
            } else if (e.keyCode == 38) {
              speedOfPaddle2 = -2;
            } else if (e.keyCode == 40) {
              speedOfPaddle2 = +2;
            }
          } else {
            ballSpeed = 3;
          }
        });

        document.addEventListener("keyup", (e) => {
          if (e.keyCode == 87) {
            speedOfPaddle1 = 0;
          } else if (e.keyCode == 83) {
            speedOfPaddle1 = 0;
          } else if (e.keyCode == 38) {
            speedOfPaddle2 = 0;
          } else if (e.keyCode == 40) {
            speedOfPaddle2 = 0;
          }
        });

        this.getNode("ball").direction = -1;
      };

      var ballDirectionl;
      var ballSpeed = 0;

      function startBall() {
        if (Math.random() < 0.5) {
          var side = 1;
        } else {
          var side = -1;
        }
        ballDirection = side * (Math.random() * 6 + 5);
        ballSpeed = Math.random() * 6 + 5;
      }

      app.onUpdate = function (time) {
        this.canvas = document.getElementById("canvas");
        var playerOne = app.getNode("player-one");
        var playerTwo = app.getNode("player-two");
        var ball = app.getNode("ball");

        playerOne.y += speedOfPaddle1;
        playerTwo.y += speedOfPaddle2;

        // preventing paddle from going off canvas
        if (playerOne.y <= 0) {
          playerOne.y = 0;
        }
        if (playerTwo.y <= 0) {
          playerTwo.y = 0;
        }
        if (playerOne.y >= canvas.height - playerOne.height) {
          playerOne.y = canvas.height - playerOne.height;
        }
        if (playerTwo.y >= canvas.height - playerTwo.height) {
          playerTwo.y = canvas.height - playerTwo.height;
        }

        let player = ball.x < canvas.width / 2 ? playerOne : playerTwo;

        if (
          (player.x == ball.x + ball.width / 2 ||
            player.x + player.width == ball.x - ball.width / 2) &&
          player.y <= ball.y &&
          ball.y <= player.y + player.height
        ) {
          //if bottom him
          this.getNode("ball").direction *= -1;
          if (ball.y > player.y + player.height / 2) {
          } else {
            //-45 degree
            angle = (Math.PI / 4) * -1;
          }
        }

        // if (ball.y <= playerOne.y) {
        //   this.getNode("ball").direction = -1;
        // } else {
        //   this.getNode("ball").direction = 1;
        // }
        this.getNode("ball").x += this.getNode("ball").direction;
      };
    </script>
  </body>
</html>
