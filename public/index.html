<!DOCTYPE html>
<html>
  <head>
    <title>Ping Pong Game</title>
    <style>
      body,
      html {
        width: 100%;
        height: 100%;
        margin: 0;
        overflow: hidden;
        display: block;
        background-color: black;
      }
    </style>
  </head>
  <body>
    <canvas
      id="canvas"
      width="800"
      height="400"
      style="
        background-color: black;
        border: 12px dashed white;
        padding-left: 0;
        padding-right: 0;
        margin-left: auto;
        margin-right: auto;
        display: block;
        width: 98%;
      "
    ></canvas>
    <script type="text/javascript" src="js/app.js"></script>
    <script type="text/javascript">
      //Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.
      var speedOfPaddle1 = null;
      var speedOfPaddle2 = null;
      var xCoordDirection = null;
      var yCoordDirection = null;
      var isGamePaused = true;
      var isGameStarted = false;
      var savedXCoordDirection = 2;
      var savedYCoordDirection = 2;
      var playerOneScore = 0;
      var playerTwoScore = -1;

      app.onInit = function () {
        this.canvas = document.getElementById("canvas");
        this.context = this.canvas.getContext("2d");

        this.nodes.push({
          id: "player-one",
          x: 10,
          y: canvas.height / 2 - (canvas.height * 0.2) / 2,
          width: canvas.width * 0.01,
          height: canvas.height * 0.2,
          color: "white",
        });

        this.nodes.push({
          id: "player-two",
          x: canvas.width - (10 + canvas.width * 0.01),
          y: canvas.height / 2 - (canvas.height * 0.2) / 2,
          width: canvas.width * 0.01,
          height: canvas.height * 0.2,
          color: "white",
        });

        this.nodes.push({
          id: "ball",
          x: canvas.width / 2,
          y: canvas.height / 2,
          width: this.getNode("player-one").width,
          height: this.getNode("player-one").width,
          color: "white",
          direction: 0,
        });

        this.nodes.push({
          id: "line",
          x: canvas.width / 2 - 3.5,
          y: 0,
          width: 7,
          height: canvas.height,
          color: "white",
        });

        this.nodes.push({
          id: "text",
          value: "Talha Khamoor's PingPong",
          sizeAndFont: "25px Arial",
          x: 30,
          y: 50,
        });

        this.nodes.push({
          id: "text",
          value:
            " - [Space] to start/Pause/Unpause game , - [r] to restart , - [w] [s] player 1 keys , - [up arrow] [down arrow] player 2 keys",
          sizeAndFont: "15px Arial",
          x: 50,
          y: 80,
        });

        document.addEventListener("keydown", (e) => {
          if (e.keyCode == 32) {
            app.pause();
            this.nodes.splice(4, this.nodes.length);
          }
          if (e.keyCode == 82) {
            app.reset();
          }
          if (!isGamePaused) {
            if (e.keyCode == 87) {
              speedOfPaddle1 = -2;
            } else if (e.keyCode == 83) {
              speedOfPaddle1 = +2;
            } else if (e.keyCode == 38) {
              speedOfPaddle2 = -2;
            } else if (e.keyCode == 40) {
              speedOfPaddle2 = +2;
            }
          }
        });

        document.addEventListener("keyup", (e) => {
          if (e.keyCode == 87) {
            speedOfPaddle1 = 0;
          } else if (e.keyCode == 83) {
            speedOfPaddle1 = 0;
          } else if (e.keyCode == 38) {
            speedOfPaddle2 = 0;
          } else if (e.keyCode == 40) {
            speedOfPaddle2 = 0;
          }
        });

        isGamePaused = true;
      };

      app.onUpdate = function (time) {
        // this.canvas = document.getElementById("canvas");
        var playerOne = this.getNode("player-one");
        var playerTwo = this.getNode("player-two");
        var ball = this.getNode("ball");

        playerOne.y += speedOfPaddle1;
        playerTwo.y += speedOfPaddle2;

        ball.x += xCoordDirection;
        ball.y += yCoordDirection;

        // preventing paddle from going off canvas
        if (playerOne.y <= 0) {
          playerOne.y = 0;
        }
        if (playerTwo.y <= 0) {
          playerTwo.y = 0;
        }
        if (playerOne.y >= canvas.height - playerOne.height) {
          playerOne.y = canvas.height - playerOne.height;
        }
        if (playerTwo.y >= canvas.height - playerTwo.height) {
          playerTwo.y = canvas.height - playerTwo.height;
        }

        let player = ball.x < canvas.width / 2 ? playerOne : playerTwo;

        //ball from leaving top and bottom
        if (ball.y <= 12 / 2 || ball.y >= canvas.height - ball.width / 2) {
          yCoordDirection = -yCoordDirection;
        }
        //ball hitting side
        if (ball.x <= 12 / 2) {
          playerTwoScore++;
          app.reset();
        } else if (ball.x >= canvas.width - ball.width / 2) {
          playerOneScore++;
          app.reset();
        }

        if (isBallTouchingPaddle(player, ball, playerOne, playerTwo)) {
          xCoordDirection = -xCoordDirection;
        }
      };

      isBallTouchingPaddle = (player, ball, playerOne, playerTwo) => {
        //player 2
        var isBallHittingYCoordinates =
          player.y <= ball.y && ball.y <= player.y + player.height
            ? true
            : false;

        if (
          player.x == ball.x + ball.width / 2 &&
          player == playerTwo &&
          isBallHittingYCoordinates
        ) {
          return true;
        } else if (
          player.x + player.width == ball.x - ball.width / 2 &&
          player == playerOne &&
          isBallHittingYCoordinates
        )
          return true;
        else {
          return false;
        }
        // player.x == ball.x + ball.width / 2 ||
        //           player.x + player.width == ball.x - ball.width / 2)
      };

      app.pause = function () {
        if (xCoordDirection == 0) {
          xCoordDirection = xCoordDirection + savedXCoordDirection;
          yCoordDirection = yCoordDirection + savedYCoordDirection;
          isGamePaused = false;
        } else {
          savedXCoordDirection = xCoordDirection;
          savedYCoordDirection = yCoordDirection;
          xCoordDirection = 0;
          yCoordDirection = 0;
          if (!isGamePaused) {
            this.nodes.push({
              id: "text",
              value:
                playerOneScore.toString() + " : " + playerTwoScore.toString(),
              sizeAndFont: "50px Arial",
              x: 600,
              y: 300,
            });
          }
          isGamePaused = true;
        }
      };

      app.reset = function () {
        var playerOne = app.getNode("player-one");
        var playerTwo = app.getNode("player-two");
        var ball = app.getNode("ball");

        ball.x = canvas.width / 2;
        ball.y = canvas.height / 2;

        savedXCoordDirection = 2;
        savedYCoordDirection = 2;

        playerOne.y = canvas.height / 2 - (canvas.height * 0.2) / 2;
        playerTwo.y = canvas.height / 2 - (canvas.height * 0.2) / 2;

        if (Math.random() < 0.5) {
          xCoordDirection = -2;
        } else {
          xCoordDirection = +2;
        }
        if (Math.random() < 0.5) {
          yCoordDirection = -2;
        } else {
          yCoordDirection = +2;
        }

        app.pause();
      };
    </script>
  </body>
</html>
